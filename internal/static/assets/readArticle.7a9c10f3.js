import{a as F,cA as M,r as p,cB as R,bt as x,c as v,e as c,F as E,i as T,g as w,h as G,u as _,t as q,b as u,n as P,_ as U}from"./index.2b950906.js";import"./el-input.ef3567cd.js";import{E as Q,a as j}from"./el-select.e6e118f3.js";import{h as k,n as J}from"./index.3c8d6064.js";import{E as K,e as I}from"./editorTheme.c6c3c0f6.js";import{_ as W}from"./lodash.467b4ce8.js";import"./index.6f56d4cc.js";import"./size.4b7247cf.js";import"./index.d64f457b.js";import"./index.fc7ea59d.js";import"./validator.34d07d43.js";import"./_Uint8Array.798c436b.js";const X=d=>k.request("post","/reading/like",{data:d}),Y=d=>k.request("get","/api/reading/content",{params:d}),Z=d=>k.request("get","/api/reading/likeinfo",{params:d}),ee=d=>k.request("post","/api/qr-code",{data:d}),te={class:"grid-content"},oe={class:"likes"},ae=["badge","onClick"],le=["src"],ne=["src"],se={class:"content"},ce={class:"editor-theme"},ie={class:"transoptions"},re={class:"directory"},ue=["title"],de={class:"catalog",id:"catalog"},ge=["id","onClick","title"],ve={class:"aside-setting"},he=["innerHTML"],pe={style:{"text-align":"left","font-size":"smaller"}},me=F({__name:"readArticle",setup(d){const C=M(),i=p([]),f=p("\u76EE\u5F55  catalog"),V=R(),$=p(""),N=p(!1),y=p(V.query.ar_id),S=p(""),s=p([]),L=new IntersectionObserver(o=>{o[0].intersectionRatio<=0||o.forEach(t=>{var a;if(t.intersectionRatio>0){const l=t.target.id.slice(6,t.target.id.length),e=document.querySelector(`#arCatalog-${l}`);f.value=e.title;for(let r=0;r<i.value.length;r++){const b=document.querySelector(`#arCatalog-${r}`);b.className="cata"}e.className="cata-active";const n=document.getElementById("catalog"),g=Number(l)-3>0?Number(l)-3:0,h=document.getElementById("phone-catalog");n&&n.scrollTo({top:g*50,behavior:"smooth"}),(a=h==null?void 0:h.parentNode)!=null&&a.parentNode&&(h.parentNode.parentNode.scrollTop=g*40)}})});async function O(o){setTimeout(()=>{for(let t=0;t<i.value.length;t++)L.observe(document.querySelector(`#title-${t}`))},1e3);for(let t=0;t<o.length&&t<i.value.length;t++){const a="\u3000";i.value[t]=a.repeat(o[t].level-1)+i.value[t]}}const z=W.throttle(function(o){let t=s.value[o].counts;s.value[o].active=!s.value[o].active,s.value[o].active?s.value[o].counts++:s.value[o].counts--,X({id:y.value,active:s.value[o].active}).then(a=>{console.log("")},a=>{console.log(a.message),s.value[o].active=!s.value[o].active,s.value[o].counts=t})},50,{trailing:!1});async function H(){window.location.hash="#title-1",window.location.hash="#title-0"}async function A(o){f.value=i.value[o],window.location.hash=`#title-${o}`;const t=o,a=document.querySelector(`#arCatalog-${t}`);for(let l=0;l<i.value.length;l++){const e=document.querySelector(`#arCatalog-${l}`);e.className="cata"}a.className="cata-active"}function D(o){var g,h;let t=/<h([1-6]) id=".*?">/,a=/<a href="#.*?>/,l=o.search(t)===-1?o:o.slice(0,o.search(t)),e=o.search(t)===-1?o:o.slice(o.search(t),o.length),n=0;for(i.value.length=0;e.search(a)!==-1;){let r=(g=e.match(t))==null?void 0:g[0],b=(h=e.match(t))==null?void 0:h[0][2],B=r==null?void 0:r.slice(8,(r==null?void 0:r.length)-2);typeof B=="string"&&i.value.push(B),e=e.replace(t,`<h${b} id="title-${n}">`),l+=e.slice(0,6),e=e.slice(6,e.length);let m=e.search(a);l+=m===-1?e:e.slice(0,e.search(a)),e=m===-1?e:e.slice(e.search(a),e.length),e=e.replace(a,`<a href="#title-${n}">`),l+=e.slice(0,6),e=e.slice(6,e.length),m=e.search(t),l+=m===-1?e:e.slice(0,e.search(t)),e=m===-1?"":e.slice(e.search(t),e.length),n++}return N.value&&(l=`<a href='${window.location.protocol+"//"+window.location.host}/creator/write?arid=${y.value}'>edit<a>`+l),l}return x(async()=>{let o=J();Y({id:y.value,user:o}).then(t=>{$.value=t.content,N.value=t.isEdit,typeof t.title=="string"&&(document.title=t.title)},t=>{location.replace(window.location.protocol+"//"+window.location.host+"/404"),console.log(t.message)}),Z({id:y.value,user:o}).then(t=>{s.value=t.options},t=>{console.log(t.message)}),ee({url:window.location.href}).then(t=>{S.value=t.svg_string},t=>{console.log(t.message)})}),(o,t)=>{const a=Q,l=j;return u(),v("div",te,[c("aside",oe,[(u(!0),v(E,null,T(s.value,(e,n)=>(u(),v("div",{class:"options",badge:e.counts,onClick:g=>_(z)(n),key:n},[e.active?(u(),v("img",{key:1,src:e.activeIcon,alt:"",class:"img-icon"},null,8,ne)):(u(),v("img",{key:0,src:e.icon,alt:"",class:"img-icon"},null,8,le))],8,ae))),128))]),c("main",se,[c("div",ce,[w(I,{flexDisplay:"row"}),c("div",ie,[w(l,{class:"m-2",ref:"phoneCatalog",placeholder:"Select",size:"small",modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=e=>f.value=e)},{default:G(()=>[(u(!0),v(E,null,T(i.value,(e,n)=>(u(),P(a,{id:"phone-catalog",key:n,label:e,value:e,onClick:g=>A(n)},null,8,["label","value","onClick"]))),128))]),_:1},8,["modelValue"])])]),w(_(K),{class:"mgb20",modelValue:$.value,"onUpdate:modelValue":t[1]||(t[1]=e=>$.value=e),previewTheme:_(C).getPreviewTheme,theme:_(C).getTheme,language:_(C).getLang,readOnly:!0,previewOnly:!0,sanitize:e=>D(e),onGetCatalog:e=>{O(e)}},null,8,["modelValue","previewTheme","theme","language","sanitize","onGetCatalog"])]),c("aside",re,[c("div",{class:"catatitle",onClick:H,title:o.$t("backTop")},[c("strong",null,q(o.$t("catalog")),1)],8,ue),c("div",de,[(u(!0),v(E,null,T(i.value,(e,n)=>(u(),v("div",{class:"cata",id:`arCatalog-${n}`,onClick:g=>A(n),title:e,key:n},q(e),9,ge))),128))]),c("div",ve,[c("div",null,[c("div",{style:{width:"100px",height:"100px"},innerHTML:S.value},null,8,he),c("p",pe,q(o.$t("qrinfo")),1)]),w(I,{flexDisplay:"column"})])])])}}});const Se=U(me,[["__scopeId","data-v-3dd27af4"]]);export{Se as default};
